<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa de Smart TV o $1'500,000</title>
    <style>
        /* Estilos para los números */
        .numero.vendido_pagado {
            background-color: green;
            color: white;
        }

        .numero.vendido_no_pagado {
            background-color: red;
            color: white;
        }

        /* Estilo del formulario */
        #formulario {
            display: none;
            background-color: #f4f4f4;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        label {
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <h1>Rifa de Smart TV o $1'500,000</h1>
    <div id="rifa">
        <table>
            <thead>
                <tr>
                    <th>Número</th>
                    <th>Estado</th>
                    <th>Comprador</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                <!-- Aquí se llenarán los números disponibles -->
                <tr>
                    <td class="numero">1</td>
                    <td class="estado">Disponible</td>
                    <td class="comprador"></td>
                    <td><button class="btnActualizar" data-numero="1">Actualizar</button></td>
                </tr>
                <tr>
                    <td class="numero">2</td>
                    <td class="estado">Disponible</td>
                    <td class="comprador"></td>
                    <td><button class="btnActualizar" data-numero="2">Actualizar</button></td>
                </tr>
                <tr>
                    <td class="numero">3</td>
                    <td class="estado">Deber</td>
                    <td class="comprador"></td>
                    <td><button class="btnActualizar" data-numero="3">Actualizar</button></td>
                </tr>
                <!-- Aquí agregarás más filas según sea necesario -->
            </tbody>
        </table>
    </div>

    <!-- Formulario para actualizar la rifa -->
    <div id="formulario">
        <h2>Actualizar Número de Rifa</h2>
        <form id="formActualizar" method="post">
            <label for="numero">Número:</label>
            <input type="text" id="numero" name="numero" required disabled>

            <label for="compradorInput">Comprador:</label>
            <input type="text" id="compradorInput" name="comprador" required>

            <label for="pagado">Pagado:</label>
            <select id="pagado" name="pagado">
                <option value="true">Sí</option>
                <option value="false">No</option>
            </select>

            <button type="submit">Actualizar</button>
        </form>
    </div>

    <script>
        // Mostrar el formulario al hacer click en el botón de actualización
        document.querySelectorAll(".btnActualizar").forEach(button => {
            button.onclick = function() {
                var numero = this.dataset.numero;
                var estado = this.closest("tr").querySelector(".estado").textContent;
                
                // Solo se muestra el formulario si el estado es 'disponible' o 'debe'
                if (estado === "Disponible" || estado === "Deber") {
                    document.getElementById("numero").value = numero;
                    document.getElementById("formulario").style.display = "block";
                } else {
                    alert("Este número no se puede actualizar porque ya está vendido.");
                }
            };
        });

        // Manejo del formulario de actualización
        document.getElementById("formActualizar").onsubmit = function(event) {
            event.preventDefault();

            // Validar que el campo de nombre no esté vacío
            var compradorInput = document.getElementById("compradorInput").value;
            if (!compradorInput.trim()) {
                alert("El nombre es obligatorio.");
                return;
            }

            var form = new FormData(event.target);

            // Enviar los datos al servidor
            fetch("/actualizar", {
                method: "POST",
                body: form
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);

                // Cambiar el color según el estado 'pagado' o 'no pagado'
                var numero = document.getElementById("numero").value;
                var estado = document.getElementById("pagado").value === "true" ? "vendido_pagado" : "vendido_no_pagado";

                // Actualizar el color del número en la interfaz
                document.querySelectorAll('.numero').forEach(function (element) {
                    if (element.textContent === numero) {
                        element.className = "numero " + estado;
                    }
                });

                // Ocultar el formulario después de actualizar
                document.getElementById("formulario").style.display = "none";
            })
            .catch(error => {
                console.error("Error al enviar el formulario:", error);
            });
        };
    </script>

</body>
</html>